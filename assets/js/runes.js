// Generated by CoffeeScript 1.6.2
(function() {
  $(document).ready(function() {
    var addRune, removeRune;

    $("ul.mark li, ul.seal li, ul.glyph li, ul.quintessence li").draggable({
      appendTo: "body",
      helper: "clone"
    }).on("dblclick", function() {
      var elem, image, type;

      elem = $(this)[0].dataset;
      type = $(this).parent().attr("class");
      image = elem.img;
      return addRune(type, image);
    }).on("mousedown", function(e) {
      var attribut, elem, image, type, value;

      if (e.button === 2) {
        elem = $(this)[0].dataset;
        type = $(this).parent().attr("class");
        attribut = elem.attribut;
        value = elem.value;
        image = elem.img;
        return addRune(type, image, attribut, value);
      }
    });
    $(".rune-page").droppable({
      drop: function(event, ui) {
        var elem, image, type;

        elem = ui.draggable[0].dataset;
        type = $(ui.draggable[0]).parent().attr("class");
        image = elem.img;
        return addRune(type, image);
      }
    });
    $(".rune-page, ul.mark li, ul.seal li, ul.glyph li, ul.quintessence li").bind("contextmenu", function() {
      return false;
    });
    $(".rune-page div[class*=mark], .rune-page div[class*=seal], .rune-page div[class*=glyph], .rune-page div[class*=quintessence]").on("mousedown", function(e) {
      if (e.button === 2) {
        return removeRune($(this));
      }
    }).on("dblclick", function() {
      return removeRune($(this));
    });
    $(".clear-page").on("click", function() {
      $(".rune-page div[class*=mark], .rune-page div[class*=seal], .rune-page div[class*=glyph], .rune-page div[class*=quintessence]").addClass("empty").children().removeAttr("class");
      return $(".statistiques").empty();
    });
    removeRune = function(elem) {
      var attribut, attributValue, newVal, oldValue;

      attribut = elem.children()[0].dataset["attribut"];
      attributValue = elem.children()[0].dataset["value"];
      oldValue = $(".statistiques div[data-attribut=\"" + attribut + "\"]").children().first().html();
      newVal = parseFloat(oldValue) - parseFloat(attributValue);
      elem.children().removeAttr("class");
      elem.children().removeAttr("data-attribut");
      elem.children().removeAttr("data-value");
      elem.addClass("empty");
      if (newVal === 0) {
        return $(".statistiques div[data-attribut=\"" + attribut + "\"]").remove();
      } else {
        return $(".statistiques div[data-attribut=\"" + attribut + "\"]").children().first().html("").html(newVal.toFixed(2));
      }
    };
    return addRune = function(type, image, attribut, value) {
      var newElem, newVal, oldValue;

      if ($(".rune-page div[class*=" + type + "][class*=empty]").length) {
        newElem = $(".rune-page div[class*=" + type + "][class*=empty]").first();
        newElem.removeClass("empty").children().addClass("icn-" + image).attr("data-attribut", attribut).attr("data-value", value);
        if ($(".statistiques div[data-attribut=\"" + attribut + "\"]").length) {
          oldValue = parseFloat($(".statistiques div[data-attribut=\"" + attribut + "\"]").children().first().html());
          newVal = oldValue + parseFloat(value);
          return $(".statistiques div[data-attribut=\"" + attribut + "\"]").children().first().html("").html(newVal.toFixed(2));
        } else {
          return $("<div data-attribut=\"" + attribut + "\">+<span>" + value + "</span> <span>" + attribut + "</span>").appendTo(".statistiques");
        }
      }
    };
  });

}).call(this);
